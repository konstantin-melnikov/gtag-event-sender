/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./gtag_event_sender.js":
/*!******************************!*\
  !*** ./gtag_event_sender.js ***!
  \******************************/
/***/ ((__unused_webpack_module, exports) => {

'use struct';

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var GtagEventSender = /*#__PURE__*/function () {
  function GtagEventSender() {
    var _this = this;

    _classCallCheck(this, GtagEventSender);

    _defineProperty(this, "env", 'prod');

    var env = this.getParam('gtag_event_sender', 'env');

    if (env) {
      this.env = env;
      this.log("Script run in ".concat(this.env, " env"));
    }

    if (this.checkGtag()) {
      document.addEventListener('DOMContentLoaded', function () {
        _this.initEvents();
      });
    } else {
      var id = this.getParam('gtag_event_sender', 'id');

      if (id) {
        this.initGtag(id);
        document.addEventListener('DOMContentLoaded', function () {
          _this.initEvents();
        });
      }
    }
  }

  _createClass(GtagEventSender, [{
    key: "initGtag",
    value: function initGtag(id) {
      this.log("Add Gtag script for ".concat(id));
      var head = document.getElementsByTagName('head')[0];
      var script = document.createElement('script');
      script.async = true;
      script.src = "https://www.googletagmanager.com/gtag/js?id=".concat(id);
      var code = document.createElement('script');
      code.text = "window.dataLayer = window.dataLayer || [];\n      function gtag(){dataLayer.push(arguments);}\n      gtag('js', new Date());\n      gtag('config', '".concat(id, "');");
      head.prepend(script, code);
    }
  }, {
    key: "initEvents",
    value: function initEvents() {
      var _this2 = this;

      var events = document.querySelectorAll("[gtag]");

      if (events !== undefined) {
        events.forEach(function (event) {
          switch (event.getAttribute('gtag')) {
            case 'click':
              _this2.eventClick(event);

              break;

            case 'submit':
              _this2.eventSubmit(event);

              break;

            case 'scroll':
              _this2.eventScroll(event);

              break;

            default:
              _this2.log("Method for event \"".concat(event.getAttribute('gtag'), "\" not found."));

              break;
          }
        });
      }
    }
  }, {
    key: "eventClick",
    value: function eventClick(element) {
      var _this3 = this;

      element.addEventListener('click', function (event) {
        _this3.sendEvent(event.target);
      });
    }
  }, {
    key: "eventSubmit",
    value: function eventSubmit(element) {
      var _this4 = this;

      element.addEventListener('submit', function (event) {
        event.preventDefault();
        event.stopPropagation();

        _this4.sendEvent(event.target);

        if (_this4.env == 'dev') {
          _this4.log({
            message: 'Form can send in prod env'
          });
        } else {
          event.target.submit();
        }
      });
    }
  }, {
    key: "eventScroll",
    value: function eventScroll(element) {
      var _this5 = this;

      var observer = new IntersectionObserver(function (entries, observer) {
        entries.forEach(function (entry) {
          if (entry.isIntersecting) {
            _this5.sendEvent(entry.target);

            observer.unobserve(entry.target);
          }
        });
      }, {});
      observer.observe(element);
    }
  }, {
    key: "sendEvent",
    value: function sendEvent(target) {
      var action = target.getAttribute('gtag_action') || false;

      if (!action) {
        this.log({
          message: 'Must be attribute gtag_action',
          target: target
        });
        return false;
      }

      var arr = ['event_category', 'event_label', 'value'];
      var params = {};
      arr.map(function (el) {
        if (target.getAttribute("gtag_".concat(el))) {
          params[el] = target.getAttribute("gtag_".concat(el));
        }
      });

      if (this.env == 'dev') {
        this.log({
          message: 'Sent event',
          event: ['event', action, params]
        });
      } else {
        gtag('event', action, params);
      }
    }
  }, {
    key: "setDevEnv",
    value: function setDevEnv() {
      this.env = 'dev';
    }
  }, {
    key: "log",
    value: function log(variable) {
      if (this.env == 'dev') {
        var callerName;

        try {
          throw new Error();
        } catch (e) {
          var re = /([^(]+)@|at ([^(]+) \(/g;
          var aRegexResult = re.exec(e.stack);
          callerName = e.stack.split('at ')[2].split(' ')[0];
        }

        console.log({
          func: callerName,
          obj: variable
        });
      }
    }
  }, {
    key: "checkGtag",
    value: function checkGtag() {
      if (window.dataLayer === undefined) {
        this.log('Gtag is not init.');
        return false;
      }

      return true;
    }
  }, {
    key: "getParam",
    value: function getParam(scriptName, paramName) {
      var scripts = document.getElementsByTagName("script");

      for (var i = 0; i < scripts.length; i++) {
        if (scripts[i].src.indexOf("/" + scriptName) > -1) {
          var pa = scripts[i].src.split("?").pop().split("&");

          for (var j = 0; j < pa.length; j++) {
            var kv = pa[j].split("=");

            if (kv[0] === paramName) {
              return kv[1];
            }
          }

          return false;
        }
      }

      return false;
    }
  }]);

  return GtagEventSender;
}();

exports.gtagEventSender = new GtagEventSender();

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		if(__webpack_module_cache__[moduleId]) {
/******/ 			return __webpack_module_cache__[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	// startup
/******/ 	// Load entry module
/******/ 	__webpack_require__("./gtag_event_sender.js");
/******/ 	// This entry module used 'exports' so it can't be inlined
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ndGFnX2V2ZW50X3NlbmRlci5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svc3RhcnR1cCJdLCJuYW1lcyI6WyJHdGFnRXZlbnRTZW5kZXIiLCJlbnYiLCJnZXRQYXJhbSIsImxvZyIsImNoZWNrR3RhZyIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImluaXRFdmVudHMiLCJpZCIsImluaXRHdGFnIiwiaGVhZCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwic2NyaXB0IiwiY3JlYXRlRWxlbWVudCIsImFzeW5jIiwic3JjIiwiY29kZSIsInRleHQiLCJwcmVwZW5kIiwiZXZlbnRzIiwicXVlcnlTZWxlY3RvckFsbCIsInVuZGVmaW5lZCIsImZvckVhY2giLCJldmVudCIsImdldEF0dHJpYnV0ZSIsImV2ZW50Q2xpY2siLCJldmVudFN1Ym1pdCIsImV2ZW50U2Nyb2xsIiwiZWxlbWVudCIsInNlbmRFdmVudCIsInRhcmdldCIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwibWVzc2FnZSIsInN1Ym1pdCIsIm9ic2VydmVyIiwiSW50ZXJzZWN0aW9uT2JzZXJ2ZXIiLCJlbnRyaWVzIiwiZW50cnkiLCJpc0ludGVyc2VjdGluZyIsInVub2JzZXJ2ZSIsIm9ic2VydmUiLCJhY3Rpb24iLCJhcnIiLCJwYXJhbXMiLCJtYXAiLCJlbCIsImd0YWciLCJ2YXJpYWJsZSIsImNhbGxlck5hbWUiLCJFcnJvciIsImUiLCJyZSIsImFSZWdleFJlc3VsdCIsImV4ZWMiLCJzdGFjayIsInNwbGl0IiwiY29uc29sZSIsImZ1bmMiLCJvYmoiLCJ3aW5kb3ciLCJkYXRhTGF5ZXIiLCJzY3JpcHROYW1lIiwicGFyYW1OYW1lIiwic2NyaXB0cyIsImkiLCJsZW5ndGgiLCJpbmRleE9mIiwicGEiLCJwb3AiLCJqIiwia3YiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7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bWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJ1Y3QnXG5cbmNsYXNzIEd0YWdFdmVudFNlbmRlciB7XG4gIGVudiA9ICdwcm9kJ1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBjb25zdCBlbnYgPSB0aGlzLmdldFBhcmFtKCdndGFnX2V2ZW50X3NlbmRlcicsICdlbnYnKVxuICAgIGlmIChlbnYpIHtcbiAgICAgIHRoaXMuZW52ID0gZW52XG4gICAgICB0aGlzLmxvZyhgU2NyaXB0IHJ1biBpbiAke3RoaXMuZW52fSBlbnZgKVxuICAgIH1cbiAgICBpZiAodGhpcy5jaGVja0d0YWcoKSkge1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcbiAgICAgICAgdGhpcy5pbml0RXZlbnRzKClcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBpZCA9IHRoaXMuZ2V0UGFyYW0oJ2d0YWdfZXZlbnRfc2VuZGVyJywgJ2lkJylcbiAgICAgIGlmIChpZCkge1xuICAgICAgICB0aGlzLmluaXRHdGFnKGlkKVxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4ge1xuICAgICAgICAgIHRoaXMuaW5pdEV2ZW50cygpXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGluaXRHdGFnKGlkKSB7XG4gICAgdGhpcy5sb2coYEFkZCBHdGFnIHNjcmlwdCBmb3IgJHtpZH1gKVxuICAgIGNvbnN0IGhlYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdXG4gICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JylcbiAgICBzY3JpcHQuYXN5bmMgPSB0cnVlXG4gICAgc2NyaXB0LnNyYz1gaHR0cHM6Ly93d3cuZ29vZ2xldGFnbWFuYWdlci5jb20vZ3RhZy9qcz9pZD0ke2lkfWBcbiAgICBjb25zdCBjb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JylcbiAgICBjb2RlLnRleHQgPSBgd2luZG93LmRhdGFMYXllciA9IHdpbmRvdy5kYXRhTGF5ZXIgfHwgW107XG4gICAgICBmdW5jdGlvbiBndGFnKCl7ZGF0YUxheWVyLnB1c2goYXJndW1lbnRzKTt9XG4gICAgICBndGFnKCdqcycsIG5ldyBEYXRlKCkpO1xuICAgICAgZ3RhZygnY29uZmlnJywgJyR7aWR9Jyk7YFxuICAgIGhlYWQucHJlcGVuZChzY3JpcHQsIGNvZGUpXG4gIH1cblxuICBpbml0RXZlbnRzKCkge1xuICAgIGNvbnN0IGV2ZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZ3RhZ11cIilcbiAgICBpZiAoZXZlbnRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGV2ZW50cy5mb3JFYWNoKChldmVudCkgPT4ge1xuICAgICAgICBzd2l0Y2ggKGV2ZW50LmdldEF0dHJpYnV0ZSgnZ3RhZycpKSB7XG4gICAgICAgICAgY2FzZSAnY2xpY2snOlxuICAgICAgICAgICAgdGhpcy5ldmVudENsaWNrKGV2ZW50KVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnc3VibWl0JzpcbiAgICAgICAgICAgIHRoaXMuZXZlbnRTdWJtaXQoZXZlbnQpXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdzY3JvbGwnOlxuICAgICAgICAgICAgdGhpcy5ldmVudFNjcm9sbChldmVudClcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aGlzLmxvZyhgTWV0aG9kIGZvciBldmVudCBcIiR7ZXZlbnQuZ2V0QXR0cmlidXRlKCdndGFnJyl9XCIgbm90IGZvdW5kLmApXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gIH1cbiAgZXZlbnRDbGljayhlbGVtZW50KSB7XG4gICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4ge1xuICAgICAgdGhpcy5zZW5kRXZlbnQoZXZlbnQudGFyZ2V0KVxuICAgIH0pXG4gIH1cbiAgZXZlbnRTdWJtaXQoZWxlbWVudCkge1xuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGV2ZW50KSA9PiB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgdGhpcy5zZW5kRXZlbnQoZXZlbnQudGFyZ2V0KVxuICAgICAgaWYgKHRoaXMuZW52ID09ICdkZXYnKSB7XG4gICAgICAgIHRoaXMubG9nKHsgbWVzc2FnZTogJ0Zvcm0gY2FuIHNlbmQgaW4gcHJvZCBlbnYnIH0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBldmVudC50YXJnZXQuc3VibWl0KClcbiAgICAgIH1cbiAgICB9KVxuICB9XG4gIGV2ZW50U2Nyb2xsKGVsZW1lbnQpIHtcbiAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcigoZW50cmllcywgb2JzZXJ2ZXIpID0+IHtcbiAgICAgIGVudHJpZXMuZm9yRWFjaChlbnRyeSA9PiB7XG4gICAgICAgIGlmIChlbnRyeS5pc0ludGVyc2VjdGluZykge1xuICAgICAgICAgIHRoaXMuc2VuZEV2ZW50KGVudHJ5LnRhcmdldClcbiAgICAgICAgICBvYnNlcnZlci51bm9ic2VydmUoZW50cnkudGFyZ2V0KVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0sIHt9KVxuICAgIG9ic2VydmVyLm9ic2VydmUoZWxlbWVudClcbiAgfVxuICBzZW5kRXZlbnQodGFyZ2V0KSB7XG4gICAgY29uc3QgYWN0aW9uID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZ3RhZ19hY3Rpb24nKSB8fCBmYWxzZVxuICAgIGlmICghYWN0aW9uKSB7XG4gICAgICB0aGlzLmxvZyh7bWVzc2FnZTogJ011c3QgYmUgYXR0cmlidXRlIGd0YWdfYWN0aW9uJywgdGFyZ2V0fSlcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgICBjb25zdCBhcnIgPSBbJ2V2ZW50X2NhdGVnb3J5JywgJ2V2ZW50X2xhYmVsJywgJ3ZhbHVlJ11cbiAgICBjb25zdCBwYXJhbXMgPSB7fVxuICAgIGFyci5tYXAoKGVsKSA9PiB7XG4gICAgICBpZiAodGFyZ2V0LmdldEF0dHJpYnV0ZShgZ3RhZ18ke2VsfWApKSB7XG4gICAgICAgIHBhcmFtc1tlbF0gPSB0YXJnZXQuZ2V0QXR0cmlidXRlKGBndGFnXyR7ZWx9YClcbiAgICAgIH1cbiAgICB9KVxuICAgIGlmICh0aGlzLmVudiA9PSAnZGV2Jykge1xuICAgICAgdGhpcy5sb2coeyBtZXNzYWdlOiAnU2VudCBldmVudCcsIGV2ZW50OiBbJ2V2ZW50JywgYWN0aW9uLCBwYXJhbXNdIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIGd0YWcoJ2V2ZW50JywgYWN0aW9uLCBwYXJhbXMpXG4gICAgfVxuICB9XG5cbiAgc2V0RGV2RW52KCkge1xuICAgIHRoaXMuZW52ID0gJ2RldidcbiAgfVxuXG4gIGxvZyh2YXJpYWJsZSkge1xuICAgIGlmICh0aGlzLmVudiA9PSAnZGV2Jykge1xuICAgICAgbGV0IGNhbGxlck5hbWVcbiAgICAgIHRyeSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcigpXG4gICAgICB9XG4gICAgICBjYXRjaCAoZSkge1xuICAgICAgICBsZXQgcmUgPSAvKFteKF0rKUB8YXQgKFteKF0rKSBcXCgvZ1xuICAgICAgICBsZXQgYVJlZ2V4UmVzdWx0ID0gcmUuZXhlYyhlLnN0YWNrKVxuICAgICAgICBjYWxsZXJOYW1lID0gZS5zdGFjay5zcGxpdCgnYXQgJylbMl0uc3BsaXQoJyAnKVswXVxuICAgICAgfSAgICAgIFxuICAgICAgY29uc29sZS5sb2coe1xuICAgICAgICBmdW5jOiBjYWxsZXJOYW1lLFxuICAgICAgICBvYmo6IHZhcmlhYmxlXG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG4gIGNoZWNrR3RhZygpIHtcbiAgICBpZiAod2luZG93LmRhdGFMYXllciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLmxvZygnR3RhZyBpcyBub3QgaW5pdC4nKVxuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICAgIHJldHVybiB0cnVlXG4gIH1cblxuICBnZXRQYXJhbShzY3JpcHROYW1lLCBwYXJhbU5hbWUpIHtcbiAgICBjb25zdCBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7XG4gICAgZm9yKGxldCBpPTA7IGk8c2NyaXB0cy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYoc2NyaXB0c1tpXS5zcmMuaW5kZXhPZihcIi9cIiArIHNjcmlwdE5hbWUpID4gLTEpIHtcbiAgICAgICAgY29uc3QgcGEgPSBzY3JpcHRzW2ldLnNyYy5zcGxpdChcIj9cIikucG9wKCkuc3BsaXQoXCImXCIpO1xuICAgICAgICBmb3IobGV0IGo9MDsgajxwYS5sZW5ndGg7IGorKykge1xuICAgICAgICAgIGNvbnN0IGt2ID0gcGFbal0uc3BsaXQoXCI9XCIpXG4gICAgICAgICAgaWYgKGt2WzBdID09PSBwYXJhbU5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBrdlsxXVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmV4cG9ydHMuZ3RhZ0V2ZW50U2VuZGVyID0gbmV3IEd0YWdFdmVudFNlbmRlcigpIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0aWYoX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSkge1xuXHRcdHJldHVybiBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZVxuX193ZWJwYWNrX3JlcXVpcmVfXyhcIi4vZ3RhZ19ldmVudF9zZW5kZXIuanNcIik7XG4vLyBUaGlzIGVudHJ5IG1vZHVsZSB1c2VkICdleHBvcnRzJyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG4iXSwic291cmNlUm9vdCI6IiJ9